{% extends 'parent/base.html' %}
{% load jformat %}
{% load blog_tags %}

{% block title %}{{ article.title }}{% endblock %}

{% block content %}
    <div class="container">
        <!-- Main content section-->
        <main>
            <!-- Breadcrumb navigation-->
            <div class="breadcrumb"><a href="{% url 'blog:home' %}">خانه</a> > <a href="{% url 'blog:article_all' %}">مقالات</a>
                > <a
                        href="{% url 'blog:article_list' article.get_category_display %}">{{ article.get_category_display }}</a>
                &gt; <span>{{ article.title }}</span>
            </div>
            <article class="card">
                <!-- Article Content-->
                <h1><a href="#">{{ article.title }}</a></h1><img
                    src="{{ article.cover.url }}" alt="تصویر مقاله">
                <section>
                    {{ article.content | markdown}}
                </section>
                <!-- Article Tags-->
                <div class="article-tags">
                    <h5>برچسب‌ها:</h5>
                    <ul class="tags-list">
                        {% for tag in article.tags.all %}
                            <li><a href="{% url 'blog:tag_list' tag.name %}">{{ tag.name }}</a></li>
                        {% endfor %}
                    </ul>

                </div>
                <!-- Date/Time & Comments Count Info-->
                <p class="article-info">تاریخ انتشار: {{ article.create_date | jformat:'%Y/%m/%d' }} |
                    ساعت {{ article.create_date | jformat:'%H:%M' }}</p>
            </article>
            <!-- Related Articles-->
            <section class="related-articles">
                <h3>آخرین مقالات</h3>

                {% last_articles as la %}
                {% for a in la %}
                    <article class="related-article card">
                        <h3><a href="{{ a.get_absolute_url }}">{{ a.title }}</a></h3>
                        <p>{{ a.content | truncatewords:10 }}</p>
                    </article>
                {% endfor %}
            </section>


            <!-- Comments Section-->
            <div class="comments-section">
                <h4>نظرات ({{ comments.count }} نظر)</h4>
                {% for comment in comments %}
                    <div class="card">
                        <h4>{{ comment.name }}</h4>
                        <p>{{ comment.message }}</p>
                        <p class="comment-info">{{ comment.created | jformat:'%H:%M - %Y/%m/%d' }}</p>
                    </div>
                {% endfor %}
                <div class="card">
                    <h4>ثبت نظر</h4>
                    {% if comment %}
                        <div class="toast">
                            <p>کامنت شما ثبت شد</p>
                        </div>
                    {% endif %}
                    <form method="POST">
                        {% csrf_token %}
                        {{ form.as_p }}
                        <button type="submit">ارسال نظر</button>
                    </form>
                </div>
            </div>
        </main>
        <!-- Sidebar-->
        <aside class="sidebar">
            <!-- Social media boxes-->
            {% include 'partials/social_link_sidebar.html' %}
            
            <div class="card">
                <form method="get" action="#">
                    <input type="text" placeholder="جستجوی نوشته‌ها...">
                    <button type="submit">>></button>
                </form>
            </div>
            <div class="card">
                <h5 class="sidebar-card-title">دسته‌بندی‌ها</h5>
                {% category_list %}
            </div>
        </aside>
    </div>
{% endblock %}